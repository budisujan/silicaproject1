<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bel Kompetisi LAN</title>
    <style>
        body {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 100vh;
            gap: 20px;
            background-color: #2c3e50;
            font-family: sans-serif;
            color: white;
        }

        #pemenangBox {
            font-size: 28px;
            font-weight: bold;
            color: #f1c40f;
            height: 40px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }

        .btn-bel {
            padding: 50px 100px;
            font-size: 30px;
            font-weight: bold;
            color: white;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            box-shadow: 0 10px #2980b9;
            transition: 0.1s;
        }

        .biru { background-color: #3498db; }

        /* Style saat tombol terkunci/ada pemenang */
        button:disabled {
            background-color: #95a5a6 !important;
            box-shadow: none !important;
            transform: translateY(5px);
            cursor: not-allowed;
        }

        #myIdText {
            background: rgba(255,255,255,0.1);
            padding: 10px 20px;
            border-radius: 5px;
        }
    </style>
</head>
<body>

    <div id="pemenangBox"></div>
    <div id="myIdText"></div>
    <button id="btnBiru" class="btn-bel biru" onclick="mainkanBel()">TEKAN BEL</button>

    <script>
        const btnBiru = document.getElementById('btnBiru');
        const displayPemenang = document.getElementById('pemenangBox');
        
        // Kita buat ID berupa angka agar bisa masuk ke variabel 'y' server
        const myNumId = Math.floor(Math.random() * 10000);
        const myName = prompt("Masukkan Nama Anda:", "Player_" + myNumId) || "Player_" + myNumId;
        document.getElementById('myIdText').innerText = "User: " + myName + " (ID: " + myNumId + ")";

        let sedangMengunci = false;
        let x = 0; // Status tekan
        let y = 0; // ID pemenang

        function mainkanBel() {
            if (sedangMengunci) return;

            // Bunyi
            const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
            const osc = audioCtx.createOscillator();
            osc.type = 'sawtooth';
            osc.connect(audioCtx.destination);
            osc.start();
            setTimeout(() => osc.stop(), 500);

            // Set data untuk dikirim ke server
            x = 1;
            y = myNumId;
            
            kunciTombol(myName);

            // Lepas kunci setelah 10 detik
            setTimeout(() => {
                bukaTombol();
            }, 10000);
        }

        function kunciTombol(nama) {
            sedangMengunci = true;
            btnBiru.disabled = true;
            displayPemenang.innerText = "PEMENANG: " + nama;
        }

        function bukaTombol() {
            sedangMengunci = false;
            btnBiru.disabled = false;
            displayPemenang.innerText = "";
            x = 0;
            y = 0;
        }

        // Loop Sinkronisasi (Mengikuti cara game kamu sebelumnya)
        setInterval(() => {
            fetch(`?id=${myNumId}&x=${x}&y=${y}`)
                .then(response => response.json())
                .then(data => {
                    for (let id in data) {
                        // Jika ada ID lain yang mengirim x=1
                        if (id != myNumId && data[id].x == "1") {
                            if (!sedangMengunci) {
                                kunciTombol("ID " + data[id].y); // data[id].y berisi ID pemenang
                                
                                // Ikut buka setelah 10 detik
                                setTimeout(() => {
                                    bukaTombol();
                                }, 10000);
                            }
                        }
                    }
                });
        }, 500);
    </script>
</body>
</html>
